---
import type { FileEntry } from '@rimitive/sandbox';

/**
 * Sandbox component for embedding live Rimitive code playgrounds in docs
 */
export interface Props {
  /** Files to display */
  files: FileEntry[];
  /** Entry file for execution (defaults to first file) */
  entryFile?: string;
  /** Height of the editor area */
  editorHeight?: string;
}

const { files, entryFile, editorHeight = '250px' } = Astro.props;

const filesJson = JSON.stringify(files);
---

<rimitive-sandbox
  data-files={filesJson}
  data-entry-file={entryFile || ''}
  data-editor-height={editorHeight}
>
  <div class="sandbox-loading">Loading sandbox...</div>
</rimitive-sandbox>

<script>
  import { createSandbox, type FileEntry } from '@rimitive/sandbox';

  class RimitiveSandbox extends HTMLElement {
    connectedCallback() {
      const filesJson = this.dataset.files || '[]';
      const entryFile = this.dataset.entryFile || undefined;
      const editorHeight = this.dataset.editorHeight || '250px';

      const files: FileEntry[] = JSON.parse(filesJson);

      // Clear loading state
      this.innerHTML = '';

      const sandbox = createSandbox({
        files,
        entryFile,
        editorHeight,
      });

      this.appendChild(sandbox.element);
    }
  }

  customElements.define('rimitive-sandbox', RimitiveSandbox);
</script>

<style>
  rimitive-sandbox {
    display: block;
    margin: 1.5rem 0;
  }

  .sandbox-loading {
    padding: 2rem;
    text-align: center;
    color: var(--sl-color-text-accent);
    background: var(--sl-color-bg-nav);
    border: 1px solid var(--sl-color-hairline);
    border-radius: 8px;
  }
</style>
